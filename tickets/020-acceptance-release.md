# #020 å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆãƒ»ãƒªãƒªãƒ¼ã‚¹æº–å‚™

**å„ªå…ˆåº¦**: é«˜
**Phase**: 8 - ãƒ†ã‚¹ãƒˆãƒ»ãƒªãƒªãƒ¼ã‚¹
**ä¾å­˜**: #001-#019
**æ‹…å½“**: PM/QA/DevOps

## ç›®çš„
MVP ã®å—ã‘å…¥ã‚ŒåŸºæº–ã‚’æº€ãŸã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€æœ¬ç•ªç’°å¢ƒã¸ã®ãƒªãƒªãƒ¼ã‚¹æº–å‚™ã‚’è¡Œã†ã€‚

## å—ã‘å…¥ã‚ŒåŸºæº–
- [ ] å…¨ã¦ã®å—ã‘å…¥ã‚ŒåŸºæº–ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹
- [ ] æœ¬ç•ªç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] LINE Webhook URL ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§æ‰‹é †ãŒç¢ºç«‹ã•ã‚Œã¦ã„ã‚‹

## å®Ÿè£…è©³ç´°

### 1. MVPå—ã‘å…¥ã‚ŒåŸºæº–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### å¿…é ˆæ©Ÿèƒ½
- [ ] LINEã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡â†’Inboxã«1åˆ†ä»¥å†…ã«åæ˜ ã•ã‚Œã‚‹
- [ ] Conversationå˜ä½ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ãŒç¢ºèªã§ãã‚‹
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰æ›´ã§ãã€ä¸€è¦§ã«åæ˜ ã•ã‚Œã‚‹
- [ ] æ‹…å½“è€…ã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰è¿”ä¿¡é€ä¿¡ã§ãã€LINEã«å±Šã
- [ ] é€ä¿¡å†…å®¹ãŒmessagesã«è¨˜éŒ²ã•ã‚Œã‚‹
- [ ] é‡è¦åº¦ãƒ»ç·Šæ€¥åº¦ãƒ»ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’æ‰‹å‹•è¨­å®šã§ãã‚‹
- [ ] Admin/Agent/Viewerã®æ¨©é™ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ç›£æŸ»ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã‚‹

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹
- [ ] Inboxç”»é¢ãŒ1ç§’ä»¥å†…ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä¼šè©±è©³ç´°ãŒ1ç§’ä»¥å†…ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãŒ3ç§’ä»¥å†…ã«å®Œäº†ã™ã‚‹

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] èªè¨¼ãªã—ã§ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
- [ ] æ¨©é™å¤–ã®æ“ä½œã¯403ã‚¨ãƒ©ãƒ¼ãŒè¿”ã‚‹
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] LINEç½²åæ¤œè¨¼ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹

### 2. æœ¬ç•ªç’°å¢ƒæ§‹ç¯‰

#### ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆï¼ˆä¾‹ï¼šVercel + Supabaseï¼‰
```
- Frontend/Backend: Vercel
- Database: Supabase (PostgreSQL)
- File Storage: Vercel Blob / S3 (å¿…è¦ã«å¿œã˜ã¦)
- Monitoring: Vercel Analytics / Sentry
```

#### ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆ.env.productionï¼‰
```bash
# Database
DATABASE_URL="postgresql://..."

# NextAuth
NEXTAUTH_SECRET="production_secret_here"
NEXTAUTH_URL="https://your-domain.com"

# LINE
LINE_CHANNEL_ACCESS_TOKEN="production_token"
LINE_CHANNEL_SECRET="production_secret"

# ãã®ä»–
NODE_ENV="production"
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

#### `deploy.sh`
```bash
#!/bin/bash
set -e

echo "ðŸš€ Starting deployment..."

# 1. ãƒ“ãƒ«ãƒ‰
echo "ðŸ“¦ Building..."
npm run build

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
echo "ðŸ—„ï¸  Running migrations..."
npx prisma migrate deploy

# 3. ãƒ‡ãƒ—ãƒ­ã‚¤
echo "â˜ï¸  Deploying to Vercel..."
vercel --prod

# 4. å‹•ä½œç¢ºèª
echo "âœ… Checking health..."
curl -f https://your-domain.com/api/health || exit 1

echo "âœ¨ Deployment completed!"
```

### 4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API

#### `src/app/api/health/route.ts`
```typescript
import { NextResponse } from 'next/server'
import { prisma } from '@/lib/prisma'

export async function GET() {
  try {
    // DBæŽ¥ç¶šç¢ºèª
    await prisma.$queryRaw`SELECT 1`

    return NextResponse.json({
      status: 'ok',
      timestamp: new Date().toISOString(),
      database: 'connected',
    })
  } catch (error) {
    return NextResponse.json(
      {
        status: 'error',
        error: 'Database connection failed',
      },
      { status: 500 }
    )
  }
}
```

### 5. LINE Webhookè¨­å®š

1. LINE Developersã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒãƒ£ãƒãƒ«è¨­å®š > Webhookè¨­å®š
3. Webhook URL: `https://your-domain.com/api/webhooks/line`
4. Webhookã®åˆ©ç”¨: ã‚ªãƒ³
5. æ¤œè¨¼ãƒœã‚¿ãƒ³ã§æŽ¥ç¶šç¢ºèª

### 6. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

#### `docs/README.md`
```markdown
# LINEå¯¾å¿œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
1. ç’°å¢ƒå¤‰æ•°è¨­å®š
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
3. åˆæœŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
4. LINE Webhookè¨­å®š

## é‹ç”¨æ‰‹é †
### æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
1. Adminç”»é¢ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† > æ–°è¦ä½œæˆ

### ã‚¿ã‚°ç®¡ç†
1. Adminç”»é¢ > ã‚¿ã‚°ç®¡ç†

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- WebhookãŒå±Šã‹ãªã„å ´åˆ
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼
- ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§
### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆæ—¥æ¬¡ï¼‰
- ç›£æŸ»ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆé€±æ¬¡ï¼‰

### å¾©æ—§æ‰‹é †
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚¹ãƒˆã‚¢
2. ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
3. å‹•ä½œç¢ºèª
```

### 7. ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

#### ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆSentryï¼‰
```typescript
// src/lib/sentry.ts
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
})
```

#### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
- Webhookå—ä¿¡ã‚¨ãƒ©ãƒ¼ï¼ˆ5åˆ†ä»¥å†…ã«3å›žä»¥ä¸Šï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¤±æ•—çŽ‡ï¼ˆ10%ä»¥ä¸Šï¼‰
- DBæŽ¥ç¶šã‚¨ãƒ©ãƒ¼
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ç•°å¸¸ï¼ˆ3ç§’ä»¥ä¸Šï¼‰

### 8. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
```bash
# æ—¥æ¬¡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆcronï¼‰
0 2 * * * pg_dump $DATABASE_URL > /backups/db_$(date +\%Y\%m\%d).sql
```

#### å¾©æ—§æ‰‹é †
```bash
# ãƒªã‚¹ãƒˆã‚¢
psql $DATABASE_URL < /backups/db_20260106.sql

# ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
npx prisma migrate status
```

### 9. ãƒªãƒªãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### ãƒ‡ãƒ—ãƒ­ã‚¤å‰
- [ ] å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ã¦ã„ã‚‹
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§å‹•ä½œç¢ºèªæ¸ˆã¿
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—æ¸ˆã¿
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’ç¢ºèªæ¸ˆã¿

#### ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚
- [ ] ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç¢ºèª
- [ ] ä¸»è¦æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

#### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œ
- [ ] LINE Webhookå—ä¿¡ç¢ºèª
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ç¢ºèª
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–ï¼ˆ1æ™‚é–“ï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›£è¦–

### 10. é‹ç”¨é–‹å§‹å¾Œã®å¯¾å¿œ

#### åˆæœŸé‹ç”¨ï¼ˆ1é€±é–“ï¼‰
- [ ] æ¯Žæ—¥ã®å‹•ä½œç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åŽé›†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æ¸¬å®š

#### ç¶™ç¶šé‹ç”¨
- [ ] é€±æ¬¡ï¼šç›£æŸ»ãƒ­ã‚°ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] æœˆæ¬¡ï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ
- [ ] æœˆæ¬¡ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦èª¿æŸ»
- [ ] å››åŠæœŸï¼šæ©Ÿèƒ½æ”¹å–„æ¤œè¨Žï¼ˆPhase 2ï¼‰

## ãƒ†ã‚¹ãƒˆé …ç›®
- [ ] å…¨ã¦ã®å—ã‘å…¥ã‚ŒåŸºæº–ã‚’æº€ãŸã—ã¦ã„ã‚‹
- [ ] æœ¬ç•ªç’°å¢ƒã§å‹•ä½œç¢ºèªã§ãã‚‹
- [ ] LINE WebhookãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] èªè¨¼ãƒ»æ¨©é™ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§æ‰‹é †ãŒå®Ÿè¡Œã§ãã‚‹

## å‚™è€ƒ
- ãƒªãƒªãƒ¼ã‚¹å¾Œ1é€±é–“ã¯ç‰¹ã«æ³¨è¦–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç©æ¥µçš„ã«åŽé›†
- Phase 2 ã®æ©Ÿèƒ½è¿½åŠ ã¯é‹ç”¨ãŒå®‰å®šã—ã¦ã‹ã‚‰
