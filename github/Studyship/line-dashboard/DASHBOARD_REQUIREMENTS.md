# ダッシュボード要件定義書

## 1. 概要

### 1.1 目的
LINE Dashboard のホーム画面として、システムの全体状況を一目で把握し、優先度の高いタスクに素早くアクセスできるダッシュボードを提供する。

### 1.2 対象ユーザー
- **Agent（担当者）**: 自分の担当会話の状況を確認
- **Admin（管理者）**: チーム全体の状況を確認し、リソース配分を判断
- **Viewer（閲覧者）**: 統計情報を閲覧

### 1.3 アクセス方法
- URL: `/dashboard` または `/`
- 認証が必要（未ログインユーザーは `/login` へリダイレクト）

---

## 2. 機能要件

### 2.1 統計情報の表示（KPI カード）

#### 2.1.1 未対応件数
- **表示内容**: 対応が必要な会話の件数
- **定義**: `lastInboundAt > lastOutboundAt` かつ `status IN (NEW, WORKING, PENDING)`
- **色**: 赤系（緊急性を示す）
- **クリック**: Inbox 画面へ遷移（未対応でフィルタ済み）

#### 2.1.2 今日の対応件数
- **表示内容**: 今日中に対応した会話の件数
- **定義**: 今日中に `lastOutboundAt` が更新された会話
- **色**: 緑系（達成感を示す）
- **クリック**: なし（情報表示のみ）

#### 2.1.3 自分の担当件数
- **表示内容**: 自分に割り当てられた会話の件数
- **定義**: `assignedUserId = currentUser.id` かつ `status NOT IN (CLOSED, RESOLVED)`
- **色**: 青系
- **クリック**: Inbox 画面へ遷移（自分の担当でフィルタ済み）

#### 2.1.4 ステータス別件数
- **表示内容**: NEW / WORKING / PENDING / RESOLVED の件数
- **表示形式**: 小さなカードまたはバッジ
- **クリック**: 各ステータスでフィルタされた Inbox へ遷移

---

### 2.2 優先対応リスト

#### 2.2.1 緊急対応が必要な会話
- **表示条件**:
  - `urgency = NOW` または `urgency = TODAY`
  - かつ未対応（`lastInboundAt > lastOutboundAt`）
- **表示内容**:
  - 顧客名
  - 最終メッセージのプレビュー
  - 経過時間（例: "3時間前"）
  - 緊急度バッジ
- **表示件数**: 最大10件
- **ソート**: `urgency` ASC → `lastInboundAt` DESC
- **クリック**: 会話詳細画面へ遷移

#### 2.2.2 SLA 期限が近い会話
- **表示条件**: `slaDeadline` が24時間以内
- **表示内容**:
  - 顧客名
  - SLA 残り時間（例: "残り2時間"）
  - ステータス
- **表示件数**: 最大5件
- **ソート**: `slaDeadline` ASC
- **クリック**: 会話詳細画面へ遷移

---

### 2.3 最近の活動

#### 2.3.1 最近の会話
- **表示内容**: 最近更新された会話
- **表示件数**: 5件
- **表示項目**:
  - 顧客名
  - 最終メッセージプレビュー
  - 更新時刻（例: "5分前"）
  - ステータスバッジ
  - 担当者名
- **ソート**: `updatedAt` DESC
- **クリック**: 会話詳細画面へ遷移

---

### 2.4 統計グラフ（Phase 2）

#### 2.4.1 会話数の推移グラフ
- **表示期間**: 過去7日間または30日間（切り替え可能）
- **グラフ種類**: 折れ線グラフまたは棒グラフ
- **データ**: 日別の新規会話数、対応完了数

#### 2.4.2 ステータス別の割合
- **グラフ種類**: ドーナツグラフまたは円グラフ
- **データ**: NEW / WORKING / PENDING / RESOLVED / CLOSED の割合

#### 2.4.3 平均応答時間の推移
- **表示期間**: 過去7日間
- **グラフ種類**: 折れ線グラフ
- **データ**: 日別の平均応答時間（初回応答時間）

---

### 2.5 クイックアクション

#### 2.5.1 ナビゲーションボタン
- **Inbox へ移動**: 全会話一覧へ
- **未対応を表示**: 未対応の会話のみフィルタ表示
- **自分の担当を表示**: 自分の担当会話のみフィルタ表示

#### 2.5.2 Admin 専用アクション（Admin のみ表示）
- **ユーザー管理**: `/admin/users` へ遷移
- **タグ管理**: `/admin/tags` へ遷移

---

## 3. 非機能要件

### 3.1 パフォーマンス
- **初期表示**: 2秒以内
- **データ更新**: リアルタイム更新は不要（手動リフレッシュまたはページ遷移時）

### 3.2 レスポンシブデザイン
- **デスクトップ**: 複数カラムレイアウト（2-3カラム）
- **タブレット**: 2カラムレイアウト
- **モバイル**: 1カラムレイアウト（縦スクロール）

### 3.3 アクセシビリティ
- 色だけに依存しない情報伝達（アイコンやテキストラベルを併用）
- キーボードナビゲーション対応

---

## 4. UI/UX 設計

### 4.1 レイアウト構成

```
┌─────────────────────────────────────────────────────────┐
│ ヘッダー（ナビゲーション）                                  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│ │ 未対応  │ │ 今日の  │ │ 自分の  │ │ ステータス│      │
│ │   12   │ │ 対応 8  │ │ 担当 5  │ │  別件数  │      │
│ └─────────┘ └─────────┘ └─────────┘ └─────────┘      │
│                                                         │
│ ┌──────────────────────┐ ┌────────────────────────┐   │
│ │ 緊急対応が必要        │ │ 最近の会話              │   │
│ ├──────────────────────┤ ├────────────────────────┤   │
│ │ 1. 山田太郎          │ │ 1. 佐藤花子            │   │
│ │    (即対応・3時間前)  │ │    (5分前・対応中)      │   │
│ │ 2. 鈴木一郎          │ │ 2. 田中次郎            │   │
│ │    (今日中・1時間前)  │ │    (15分前・新規)       │   │
│ │ ...                  │ │ ...                    │   │
│ └──────────────────────┘ └────────────────────────┘   │
│                                                         │
│ ┌─────────────────────────────────────────────────┐   │
│ │ クイックアクション                                  │   │
│ │ [Inbox へ] [未対応を表示] [自分の担当を表示]      │   │
│ └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2 カラースキーム
- **未対応**: 赤系（`bg-red-50`, `text-red-700`）
- **対応済み**: 緑系（`bg-green-50`, `text-green-700`）
- **自分の担当**: 青系（`bg-blue-50`, `text-blue-700`）
- **警告（SLA）**: オレンジ系（`bg-orange-50`, `text-orange-700`）

### 4.3 インタラクション
- **カードホバー**: 背景色を少し明るくする
- **クリック**: 対応するページへスムーズに遷移
- **ローディング**: スケルトンスクリーンを表示

---

## 5. API 設計

### 5.1 必要な API エンドポイント

#### GET `/api/dashboard/stats`
**レスポンス例**:
```json
{
  "needsActionCount": 12,
  "todayResponseCount": 8,
  "myAssignedCount": 5,
  "statusCounts": {
    "NEW": 3,
    "WORKING": 7,
    "PENDING": 2,
    "RESOLVED": 15,
    "CLOSED": 10
  }
}
```

#### GET `/api/dashboard/urgent`
**レスポンス例**:
```json
{
  "conversations": [
    {
      "id": "...",
      "contact": {
        "displayName": "山田太郎",
        "pictureUrl": "..."
      },
      "lastMessagePreview": "商品が届かないのですが...",
      "lastInboundAt": "2025-01-07T10:00:00Z",
      "urgency": "NOW",
      "priority": "HIGH"
    }
  ]
}
```

#### GET `/api/dashboard/recent`
**レスポンス例**:
```json
{
  "conversations": [
    {
      "id": "...",
      "contact": {
        "displayName": "佐藤花子"
      },
      "lastMessagePreview": "ありがとうございました",
      "updatedAt": "2025-01-07T11:50:00Z",
      "status": "WORKING",
      "assignedUser": {
        "name": "山田エージェント"
      }
    }
  ]
}
```

---

## 6. 実装優先度

### Phase 1（MVP）
1. ✅ 統計情報カード（未対応、今日の対応、自分の担当、ステータス別）
2. ✅ 緊急対応が必要な会話リスト
3. ✅ 最近の会話リスト
4. ✅ クイックアクション（ナビゲーションボタン）
5. ✅ レスポンシブデザイン

### Phase 2（拡張機能）
- 統計グラフの追加
- SLA 期限が近い会話リスト
- リアルタイム更新（WebSocket）
- エクスポート機能（CSV/PDF）
- カスタマイズ可能なウィジェット

---

## 7. 成功指標

### 7.1 定量的指標
- ダッシュボードからの Inbox 遷移率: 60%以上
- 緊急対応リストからの会話詳細アクセス率: 80%以上
- 平均ページ読み込み時間: 2秒以内

### 7.2 定性的指標
- エージェントが「優先すべきタスクが一目でわかる」と感じる
- 管理者が「チームの状況を把握しやすい」と感じる

---

## 8. 技術スタック

- **フロントエンド**: Next.js 15 App Router, React 19, TypeScript
- **スタイリング**: Tailwind CSS
- **データ取得**: Server Components + API Routes
- **日時フォーマット**: date-fns
- **グラフ（Phase 2）**: Recharts または Chart.js

---

## 9. 今後の検討事項

- ウィジェットの表示/非表示をユーザーごとにカスタマイズ
- ダークモード対応
- 通知機能との連携
- モバイルアプリへの対応
